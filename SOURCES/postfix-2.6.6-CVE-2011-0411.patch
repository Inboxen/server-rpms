diff -up postfix-2.6.6/src/smtpd/smtpd.c.orig postfix-2.6.6/src/smtpd/smtpd.c
--- postfix-2.6.6/src/smtpd/smtpd.c.orig	2010-03-20 01:44:11.000000000 +0100
+++ postfix-2.6.6/src/smtpd/smtpd.c	2011-03-09 17:51:27.755459925 +0100
@@ -4072,6 +4072,8 @@ static int starttls_cmd(SMTPD_STATE *sta
     smtpd_chat_reply(state, "220 2.0.0 Ready to start TLS");
     /* Flush before we switch the stream's read/write routines. */
     smtp_flush(state->client);
+    /* At this point there must not be any pending plaintext. */
+    vstream_fpurge(state->client, VSTREAM_PURGE_BOTH);
 
     /*
      * Reset all inputs to the initial state.
diff -up postfix-2.6.6/src/smtp/smtp_proto.c.orig postfix-2.6.6/src/smtp/smtp_proto.c
--- postfix-2.6.6/src/smtp/smtp_proto.c.orig	2009-04-28 20:50:39.000000000 +0200
+++ postfix-2.6.6/src/smtp/smtp_proto.c	2011-03-09 17:50:56.867637247 +0100
@@ -812,6 +812,9 @@ static int smtp_start_tls(SMTP_STATE *st
 				   SMTP_RESP_FAKE(&fake, "4.7.5"),
 				   "Server certificate not verified"));
 
+    /* At this point there must not be any pending plaintext. */
+    vstream_fpurge(session->stream, VSTREAM_PURGE_BOTH);
+
     /*
      * At this point we have to re-negotiate the "EHLO" to reget the
      * feature-list.
